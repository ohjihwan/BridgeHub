<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>WebRTC ì±„íŒ…ë°©</title>
    <style>
      * {
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #2f3349;
        min-height: 100vh;
        max-width: 1400px;
        margin: 0 auto;
        color: #ffffff;
      }
      
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
        flex-wrap: wrap;
        gap: 16px;
      }
      
      h1 {
        color: #ffffff;
        font-size: 1.875rem;
        font-weight: 600;
        letter-spacing: -0.025em;
        margin: 0;
        flex: 1;
        text-align: center;
      }
      
      .timer-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 200px;
      }
      
      .timer-icon {
        font-size: 1.2rem;
      }
      
      .timer-text {
        font-weight: 600;
        font-size: 14px;
      }
      
      .timer-warning {
        background: rgba(255, 193, 7, 0.2);
        border-color: rgba(255, 193, 7, 0.3);
        color: #ffc107;
      }
      
      .timer-danger {
        background: rgba(220, 53, 69, 0.2);
        border-color: rgba(220, 53, 69, 0.3);
        color: #dc3545;
        animation: pulse-danger 1s infinite;
      }
      
      @keyframes pulse-danger {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      
      .controls {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 32px;
        padding: 24px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .controls button {
        padding: 12px 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        min-width: 100px;
      }
      
      .controls button:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: #3b82f6;
      }
      
      .controls button:active {
        background: rgba(255, 255, 255, 0.15);
      }
      
      .video-wrapper {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
        max-width: 100%;
      }
      
      .video-container {
        background: #36393f;
        border-radius: 12px;
        padding: 0;
        text-align: center;
        border: 2px solid #40444b;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .video-container:hover {
        border-color: #5865f2;
      }
      
      .video-container div, .nickname {
        position: absolute;
        bottom: 12px;
        left: 12px;
        font-weight: 600;
        color: #ffffff;
        font-size: 14px;
        background: rgba(0, 0, 0, 0.7);
        padding: 6px 12px;
        border-radius: 6px;
        z-index: 10;
        margin: 0;
      }
      
      video {
        width: 100%;
        height: 100%;
        min-height: 300px;
        background: #1e2124;
        border-radius: 12px;
        object-fit: cover;
        display: block;
      }
      
      /* ë¹ˆ ìë¦¬ ì•„ì´ì½˜ */
      .video-container.empty::before {
        content: "ğŸ‘¤";
        font-size: 4rem;
        opacity: 0.3;
        position: absolute;
        z-index: 5;
        color: #72767d;
      }
      
      .video-container.has-video {
        display: block;
      }
      
      .video-container.has-video::before {
        display: none;
      }
      
      #status-text {
        margin-top: 8px;
        font-size: 0.875rem;
        color: #b9bbbe;
        font-style: italic;
      }
      
      /* í™”ë©´ ê³µìœ  ì‹œ ë ˆì´ì•„ì›ƒ */
      body.sharing .video-wrapper {
        display: grid;
        grid-template-columns: 1fr 400px;
        grid-template-rows: auto;
        gap: 16px;
        align-items: start;
      }

      body.sharing .video-container#my-container {
        grid-column: 1;
        grid-row: 1;
        min-height: 500px;
      }

      body.sharing .video-container#my-container video {
        min-height: 500px;
      }

      /* ë‚˜ë¨¸ì§€ ì°¸ì—¬ìë“¤ì„ ì˜¤ë¥¸ìª½ì— ì„¸ë¡œë¡œ ë°°ì¹˜ */
      body.sharing .video-container:not(#my-container) {
        grid-column: 2;
        min-height: 150px;
        margin-bottom: 8px;
      }

      body.sharing .video-container:not(#my-container) video {
        min-height: 150px;
      }

      body.sharing .video-container:not(#my-container):nth-child(2) {
        grid-row: 1;
      }

      body.sharing .video-container:not(#my-container):nth-child(3) {
        grid-row: 2;
      }

      body.sharing .video-container:not(#my-container):nth-child(4) {
        grid-row: 3;
      }

      body.sharing .video-container:not(#my-container):nth-child(5) {
        grid-row: 4;
      }
      
      /* ì±„íŒ… íŒ¨ë„ */
      #chat-panel {
        position: fixed;
        top: 0;
        right: -380px;
        width: 360px;
        height: 100%;
        background: #36393f;
        border-left: 1px solid #40444b;
        box-shadow: -4px 0 6px -1px rgb(0 0 0 / 0.3);
        transition: right 0.3s ease;
        display: flex;
        flex-direction: column;
        z-index: 999;
      }
      
      #chat-panel.open {
        right: 0;
      }
      
      .chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: #2f3136;
        border-bottom: 1px solid #40444b;
        color: #ffffff;
        font-weight: 600;
        font-size: 16px;
      }
      
      .chat-close {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
        font-size: 14px;
        cursor: pointer;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      
      .chat-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      
      #chat-box {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #36393f;
        font-size: 14px;
        line-height: 1.5;
      }
      
      #chat-box p {
        margin: 8px 0;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #dcddde;
      }
      
      #chat-box::-webkit-scrollbar {
        width: 6px;
      }
      
      #chat-box::-webkit-scrollbar-thumb {
        background: #5865f2;
        border-radius: 3px;
      }
      
      #chat-box::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .chat-input-wrapper {
        display: flex;
        border-top: 1px solid #40444b;
        background: #2f3136;
      }
      
      #chat-input {
        flex: 1;
        padding: 16px;
        border: none;
        background: transparent;
        font-size: 14px;
        outline: none;
        color: #dcddde;
      }
      
      #chat-input::placeholder {
        color: #72767d;
      }
      
      .chat-input-wrapper button {
        padding: 16px 20px;
        border: none;
        background: #5865f2;
        color: white;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      
      .chat-input-wrapper button:hover {
        background: #4752c4;
      }
      
      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 1200px) {
        .video-wrapper {
          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
        
        body.sharing .video-wrapper {
          grid-template-columns: 1fr;
          grid-template-rows: auto;
        }
        
        body.sharing .video-container#my-container {
          grid-column: 1;
          margin-bottom: 16px;
        }
        
        body.sharing .video-container:not(#my-container) {
          grid-column: 1;
          display: inline-block;
          width: calc(50% - 8px);
          margin: 0 4px 8px 4px;
          vertical-align: top;
        }
      }
      
      @media (max-width: 768px) {
        body {
          padding: 16px;
        }
        
        .header {
          flex-direction: column;
          text-align: center;
        }
        
        h1 {
          font-size: 1.5rem;
          margin-bottom: 16px;
        }
        
        .timer-container {
          order: -1;
          margin-bottom: 16px;
        }
        
        .controls {
          padding: 16px;
          gap: 8px;
        }
        
        .controls button {
          padding: 10px 16px;
          font-size: 13px;
          min-width: 80px;
        }
        
        .video-wrapper {
          grid-template-columns: 1fr;
          gap: 12px;
        }
        
        .video-container {
          min-height: 250px;
        }
        
        video {
          min-height: 250px;
        }
        
        #chat-panel {
          width: 100%;
          right: -100%;
        }
        
        body.sharing .video-container:not(#my-container) {
          width: 100%;
          margin: 0 0 8px 0;
        }
      }
      
      @media (max-width: 480px) {
        .controls {
          flex-direction: column;
          align-items: center;
        }
        
        .controls button {
          width: 100%;
          max-width: 200px;
        }
        
        .video-container {
          min-height: 200px;
        }
        
        video {
          min-height: 200px;
        }
      }
      
      /* ë¹ˆ ìë¦¬ í‘œì‹œ */
      .video-container:has(.nickname:contains("ë¹ˆ ìë¦¬")) {
        opacity: 0.6;
        background: #2f3136;
      }
      
      .video-container:has(.nickname:contains("ë¹ˆ ìë¦¬")) .nickname {
        color: #72767d;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1 id="title">P2P ì—°ê²° ì¤‘...</h1>
      <div class="timer-container" id="timer-container">
        <span class="timer-icon">â°</span>
        <span class="timer-text" id="timer-display">íšŒì˜ ì‹œê°„: 2ì‹œê°„ 00ë¶„ 00ì´ˆ</span>
      </div>
    </div>
    
    <div class="controls">
      <button id="toggle-camera" onclick="toggleCamera()">ì¹´ë©”ë¼ ë„ê¸°</button>
      <button id="toggle-mic" onclick="toggleMic()">ìŒì†Œê±°</button>
      <button onclick="leaveRoom()">ë‚˜ê°€ê¸°</button>
      <button id="share-screen" onclick="toggleScreenShare()">í™”ë©´ ê³µìœ </button>
      <button onclick="toggleChat()">ì±„íŒ…</button>
    </div>
    
    <div class="video-wrapper">
      <div class="video-container has-video" id="my-container">
        <div>ë‚˜</div>
        <video id="myFace" playsinline autoplay muted></video>
      </div>
      <!-- ìƒëŒ€ë°© ìë¦¬ -->
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
      <div class="video-container empty"><div class="nickname">ë¹ˆ ìë¦¬</div>
<video class="peerVideo" playsinline autoplay></video></div>
    </div>

    <!-- ì±„íŒ… íŒ¨ë„ -->
    <div id="chat-panel">
      <div class="chat-header">
        <span>ğŸ’¬ ì±„íŒ…</span>
        <button class="chat-close" onclick="toggleChat()">Ã—</button>
      </div>
      <div id="chat-box"></div>
      <div class="chat-input-wrapper">
        <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
        <button onclick="sendChat()">ì „ì†¡</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
    <script>
      const urlParams = new URLSearchParams(location.search);
      const room = urlParams.get("room");
      const nickname = urlParams.get("name");

      // íƒ€ì´ë¨¸ ê´€ë ¨ ë³€ìˆ˜
      let meetingStartTime = Date.now();
      let meetingDuration = 2 * 60 * 60 * 1000; // 2ì‹œê°„ (ë°€ë¦¬ì´ˆ)
      let timerInterval;

      function assignPeerNickname(nickname) {
        const labels = document.querySelectorAll(".nickname");
        for (const label of labels) {
          if (label.textContent === "ë¹ˆ ìë¦¬") {
            label.textContent = nickname;
            // ë¹ˆ ìë¦¬ í´ë˜ìŠ¤ ì œê±°í•˜ê³  has-video í´ë˜ìŠ¤ ì¶”ê°€
            const container = label.closest('.video-container');
            container.classList.remove('empty');
            container.classList.add('has-video');
            break;
          }
        }
      }

      function removePeerNickname(nickname) {
        const labels = document.querySelectorAll(".nickname");
        for (const label of labels) {
          if (label.textContent === nickname) {
            label.textContent = "ë¹ˆ ìë¦¬";
            // í•´ë‹¹ ë¹„ë””ì˜¤ë„ ì´ˆê¸°í™”
            const videoContainer = label.closest('.video-container');
            const video = videoContainer.querySelector('video');
            if (video) {
              video.srcObject = null;
            }
            // has-video í´ë˜ìŠ¤ ì œê±°í•˜ê³  empty í´ë˜ìŠ¤ ì¶”ê°€
            videoContainer.classList.remove('has-video');
            videoContainer.classList.add('empty');
            break;
          }
        }
      }

      function formatTime(milliseconds) {
        const totalSeconds = Math.floor(milliseconds / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        
        return `${hours}ì‹œê°„ ${minutes.toString().padStart(2, '0')}ë¶„ ${seconds.toString().padStart(2, '0')}ì´ˆ`;
      }

      function updateTimer() {
        const currentTime = Date.now();
        const elapsedTime = currentTime - meetingStartTime;
        const remainingTime = meetingDuration - elapsedTime;
        
        const timerDisplay = document.getElementById('timer-display');
        const timerContainer = document.getElementById('timer-container');
        
        if (remainingTime <= 0) {
          // ì‹œê°„ ì¢…ë£Œ
          timerDisplay.textContent = 'íšŒì˜ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤';
          timerContainer.classList.add('timer-danger');
          clearInterval(timerInterval);
          
          // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ë°© ë‚˜ê°€ê¸°
          setTimeout(() => {
            alert('íšŒì˜ ì‹œê°„ì´ ì¢…ë£Œë˜ì–´ ë°©ì—ì„œ ë‚˜ê°‘ë‹ˆë‹¤.');
            leaveRoom();
          }, 3000);
          
          return;
        }
        
        timerDisplay.textContent = `íšŒì˜ ì‹œê°„: ${formatTime(remainingTime)}`;
        
        // 30ë¶„ ì´í•˜ì¼ ë•Œ ê²½ê³  ìƒ‰ìƒ
        if (remainingTime <= 30 * 60 * 1000) {
          timerContainer.classList.add('timer-warning');
        }
        
        // 5ë¶„ ì´í•˜ì¼ ë•Œ ìœ„í—˜ ìƒ‰ìƒ
        if (remainingTime <= 5 * 60 * 1000) {
          timerContainer.classList.remove('timer-warning');
          timerContainer.classList.add('timer-danger');
        }
      }

      function startTimer() {
        updateTimer(); // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
        timerInterval = setInterval(updateTimer, 1000); // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
      }

      if (!room || !nickname) {
        alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.");
        location.href = "/";
      }

      document.getElementById("title").innerText = `ë°©: ${room} | ë‹‰ë„¤ì„: ${nickname}`;

      const myFace = document.getElementById("myFace");
      const peerVideos = document.querySelectorAll(".peerVideo");
      const chatBox = document.getElementById("chat-box");
      const chatInput = document.getElementById("chat-input");

      let myStream;
      let myPeerConnection;
      let isScreenSharing = false;
      let screenTrack = null;

      const socket = io();

      socket.emit("join", { roomId: room, nickname });

      socket.on("room-full", () => {
        alert("ì…ì¥ ì¸ì› ì´ˆê³¼");
        location.href = "/";
      });

      socket.on("user-joined", (data) => {
        const { nickname: joinedNickname } = data;
        assignPeerNickname(joinedNickname);
        appendChat("ì‹œìŠ¤í…œ", `${joinedNickname}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤.`);
      });

      socket.on("user-left", (data) => {
        const { nickname: leftNickname } = data;
        removePeerNickname(leftNickname);
        appendChat("ì‹œìŠ¤í…œ", `${leftNickname}ë‹˜ì´ ë°©ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.`);
      });

      socket.on("rtc-message", async (message) => {
        const content = JSON.parse(message);
        if (content.event === "offer") {
          await initConnection();
          await myPeerConnection.setRemoteDescription(content.data);
          myStream.getTracks().forEach(track => myPeerConnection.addTrack(track, myStream));
          const answer = await myPeerConnection.createAnswer();
          await myPeerConnection.setLocalDescription(answer);
          sendSignal("answer", answer);
        } else if (content.event === "answer") {
          await myPeerConnection.setRemoteDescription(content.data);
        } else if (content.event === "candidate") {
          if (content.data) await myPeerConnection.addIceCandidate(content.data);
        }
      });

      socket.on("chat-message", (data) => {
        const { from, message, timestamp } = JSON.parse(data);
        appendChat(from, message, timestamp);
      });

      socket.on("peer-left", () => {
        appendChat("ì‹œìŠ¤í…œ", "ìƒëŒ€ë°©ì´ ë°©ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.");
      });

      chatInput.addEventListener("keyup", (e) => {
        if (e.key === "Enter") sendChat();
      });

      async function getMedia() {
        try {
          myStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
          myFace.srcObject = myStream;
        } catch (e) {
          console.error("Media Error:", e);
          alert("ì¹´ë©”ë¼/ë§ˆì´í¬ ì ‘ê·¼ ì‹¤íŒ¨");
        }
      }

      async function initConnection() {
        myPeerConnection = new RTCPeerConnection({
          iceServers: [{ url: "stun:stun.l.google.com:19302" }],
        });

        myPeerConnection.onicecandidate = (event) => {
          if (event.candidate) sendSignal("candidate", event.candidate);
        };

        myPeerConnection.addEventListener("addstream", (e) => {
          const peerVideo = Array.from(peerVideos).find(v => !v.srcObject);
          if (peerVideo) {
            peerVideo.srcObject = e.stream;
            // ìŠ¤íŠ¸ë¦¼ì´ ì¶”ê°€ë  ë•Œ ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ë³€ê²½
            const container = peerVideo.closest('.video-container');
            const nicknameLabel = container.querySelector('.nickname');
            if (nicknameLabel && nicknameLabel.textContent === "ë¹ˆ ìë¦¬") {
              nicknameLabel.textContent = "ì°¸ì—¬ì";
            }
            container.classList.remove('empty');
            container.classList.add('has-video');
          }
        });
      }

      async function createOffer() {
        await initConnection();
        if (!myStream) return;
        myStream.getTracks().forEach(track => myPeerConnection.addTrack(track, myStream));
        const offer = await myPeerConnection.createOffer();
        await myPeerConnection.setLocalDescription(offer);
        sendSignal("offer", offer);
      }

      async function startConnection() {
        await getMedia();       // âœ… ë°˜ë“œì‹œ ë¨¼ì € ì¹´ë©”ë¼ ì¡ê³ 
        await createOffer();    // âœ… ê·¸ ë‹¤ìŒ ì—°ê²° ì‹œì‘
        startTimer();           // âœ… íƒ€ì´ë¨¸ ì‹œì‘
      }

      function sendSignal(event, data) {
        socket.emit("rtc-message", JSON.stringify({ roomId: room, event, data }));
      }

      function sendChat() {
        const msg = chatInput.value.trim();
        if (!msg) return;
        const now = Date.now();
        socket.emit("chat-message", JSON.stringify({ roomId: room, from: nickname, message: msg, timestamp: now }));
        appendChat(nickname, msg, now);
        chatInput.value = "";
      }

      function appendChat(who, msg, time = null) {
        const p = document.createElement("p");
        const now = time ? new Date(time) : new Date();
        const hhmm = now.toLocaleTimeString("ko-KR", { hour: "2-digit", minute: "2-digit", hour12: false });
        p.textContent = `[${hhmm}] ${who}: ${msg}`;
        chatBox.appendChild(p);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function toggleCamera() {
        if (!myStream) return;
        const videoTrack = myStream.getVideoTracks()[0];
        videoTrack.enabled = !videoTrack.enabled;
        document.getElementById("toggle-camera").innerText = videoTrack.enabled ? "ì¹´ë©”ë¼ ë„ê¸°" : "ì¹´ë©”ë¼ ì¼œê¸°";
      }

      function toggleMic() {
        if (!myStream) return;
        const audioTrack = myStream.getAudioTracks()[0];
        audioTrack.enabled = !audioTrack.enabled;
        document.getElementById("toggle-mic").innerText = audioTrack.enabled ? "ìŒì†Œê±°" : "ë§ˆì´í¬ ì¼œê¸°";
      }

      function leaveRoom() {
        if (timerInterval) {
          clearInterval(timerInterval);
        }
        if (myPeerConnection) {
          myPeerConnection.close();
          myPeerConnection = null;
        }
        socket.disconnect();
        location.href = "/";
      }

      async function toggleScreenShare() {
        if (!isScreenSharing) {
          try {
            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
            screenTrack = stream.getVideoTracks()[0];
            const sender = myPeerConnection.getSenders().find(s => s.track.kind === "video");
            if (sender) sender.replaceTrack(screenTrack);
            myFace.srcObject = new MediaStream([screenTrack]);
            screenTrack.onended = () => stopScreenShare();
            isScreenSharing = true;
            document.getElementById("share-screen").innerText = "ê³µìœ  ì¤‘ì§€";
            document.body.classList.add("sharing");
          } catch (e) {
            console.error("í™”ë©´ ê³µìœ  ì˜¤ë¥˜:", e);
          }
        } else {
          stopScreenShare();
        }
      }

      function stopScreenShare() {
        if (!isScreenSharing) return;
        const sender = myPeerConnection.getSenders().find(s => s.track.kind === "video");
        if (sender && myStream) {
          sender.replaceTrack(myStream.getVideoTracks()[0]);
          myFace.srcObject = myStream;
        }
        screenTrack?.stop();
        screenTrack = null;
        isScreenSharing = false;
        document.getElementById("share-screen").innerText = "í™”ë©´ ê³µìœ ";
        document.body.classList.remove("sharing");
      }

      function toggleChat() {
        document.getElementById("chat-panel").classList.toggle("open");
      }

      // âœ… ì—°ê²° ì‹œì‘
      startConnection();
    </script>
  </body>
</html>
